<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8" />
    <title>Auto Translate Static Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            transition: all 0.3s ease;
        }

        html[dir="rtl"] body {
            text-align: right;
        }

        button {
            margin: 5px;
            padding: 10px 15px;
            cursor: pointer;
        }

        .lang-switch {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>

    <div class="lang-switch">
        <button onclick="setLanguage('en')">English</button>
        <button onclick="setLanguage('ar')">عربي</button>
        <button onclick="addDataTranslate()">🛠 Add data-translate</button>
    </div>

    <!-- Sample Content -->
    <h2><span>Patient</span> Dashboard</h2>
    <p>Reserve a new</p>
    <a href="#">Scheduling</a>
    <h3><strong>Favorites Doctor</strong></h3>
    <button>Logout</button>

    <script>
        // 🧠 Translations object
        const translations = {
            en: {
                patient_dashboard: "Patient Dashboard",
                reserve_a_new: "Reserve a new",
                scheduling: "Scheduling",
                favorites_doctor: "Favorites Doctor",
                logout: "Logout"
            },
            ar: {
                patient_dashboard: "لوحة تحكم المريض",
                reserve_a_new: "احجز موعدًا جديدًا",
                scheduling: "جدولة",
                favorites_doctor: "الأطباء المفضلون",
                logout: "تسجيل الخروج"
            }
        };

        // 🚀 Language switcher with localStorage
        function setLanguage(lang) {
            localStorage.setItem("selectedLanguage", lang);
            document.documentElement.setAttribute("lang", lang);
            document.documentElement.setAttribute("dir", lang === "ar" ? "rtl" : "ltr");

            const elements = document.querySelectorAll("[data-translate]");
            const content = translations[lang];

            elements.forEach((el) => {
                const key = el.getAttribute("data-translate");
                if (content[key]) {
                    el.textContent = content[key];
                }
            });
        }

        // 🧠 Load stored language or default to English
        const savedLang = localStorage.getItem("selectedLanguage") || "en";
        setLanguage(savedLang);

        // 🛠 Auto apply data-translate to inner-most text elements
        function addDataTranslate() {
            const allowedTags = ["H1", "H2", "H3", "H4", "H5", "H6", "P", "SPAN", "BUTTON", "A", "LABEL", "TH", "TD", "LI", "STRONG", "SMALL"];
            let keyCounter = 1;
            const usedKeys = new Set();

            const cleanKey = (text) => {
                let key = text
                    .toLowerCase()
                    .replace(/[^a-z0-9]+/g, "_")
                    .replace(/^_+|_+$/g, "");
                if (!key || usedKeys.has(key)) {
                    key = `key_${keyCounter++}`;
                }
                usedKeys.add(key);
                return key;
            };

            const isLeafTextElement = (el) => {
                const text = el.textContent.trim();
                if (!text) return false;
                return ![...el.children].some(child => child.textContent.trim());
            };

            const elements = document.querySelectorAll("body *");

            elements.forEach((el) => {
                const tag = el.tagName;
                const text = el.textContent.trim();

                if (
                    !allowedTags.includes(tag) ||
                    el.hasAttribute("data-translate") ||
                    !text ||
                    !isLeafTextElement(el)
                ) return;

                const key = cleanKey(text);
                el.setAttribute("data-translate", key);

                // Optional: Auto-fill translations object if needed
                if (!translations.en[key]) translations.en[key] = text;
                if (!translations.ar[key]) translations.ar[key] = ""; // empty Arabic placeholder
            });

            alert("✅ data-translate added to inner-most text elements!");
            console.log("📦 Updated translations:\n", translations);
        }
    </script>
</body>

</html>